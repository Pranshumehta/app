<!DOCTYPE html>
<html>
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <title></title>
	    <script src="js/mui.min.js"></script>
	    <link href="css/mui.min.css" rel="stylesheet"/>
	    <link href="css/css.css" rel="stylesheet" type="text/css" />
	    <link href="css/iphone.css" rel="stylesheet" type="text/css" />
	    <style>
	    .mui-loader {
			position: absolute;
			top: 25%;
			width: 100%;
			height: 60%;
			color: #888;
			font-size: 14px;
			text-align: center;
		}
		    .Red-envelopes{
		    	margin: 0;
		    }
		    .Red-envelopes li{
		    	margin-top: 20px;
		    }
		    .hongbao-num:active,.hongbao-cond:active{
		    	background-color: #EFEFEF ;
		    }
	    	.hongbao-num,.hongbao-cond{
	    		margin:0 auto;
	    		width: 94%;
	    		height: 100px;
	    		background-color: #fff;
	    		border-radius: 6px;
	    	}
	    	.hongbao-num img{
	    		display: block;
	    		width: 100%;
	    		height: auto;     
	    	}
	    	.hb-je{
	    		padding-right:20px;
	    		margin-top: 20px;
	    		/*width: 40%;*/
	    		float: left;
	    		line-height: 50px;
	    		font-size: 30px;
	    		padding-left: 15px;
	    	}
	    	.hongbao-num h5{
	    		width: 50%;
	    		margin-top: 20px;
	    		float: left;
	    		line-height: 30px;
	    		color: #3B3B3B;
	    		font-size: 18px;
	    	}
	    	.hongbao-num p{
	    		line-height: 20px;
	    		float: left;
	    		color: #b2b2b2;
	    		font-size: 12px;
	    	}
	    	.hongbao-cond{
	    		padding: 0 15px;
	    		margin-top: 2px;
	    		height: 35px;
	    		line-height: 35px;
	    		color: #6b6b6b;
	    	}
	    	.hongbao-cond span,{
	    		color: #6b6b6b;
	    	}
	    	.hongbao-cond a{
	    		color: #6b6b6b;
	    		float: right;
	    	}
	    	.notes-moblie {
			    background: url(images/zwhb.png) no-repeat 0px 0px;
			    display: block;
			    width: 60px;
			    height: 60px;
			    background-size: 60px;
			    margin: 0px auto;
			    margin-top: 30px;
			}
	    </style>
	    
	</head>
	<body>
		<header class="mui-bar mui-bar-nav header">
			<a id="close" class="mui-icon mui-action-back mui-icon-left-nav mui-pull-left" style="color: #999;"></a>
			<h1 id="title" class="mui-title">可用红包</h1>
		</header>

		<div class="mui-content" >
			<div class="mui-loader" id="mui-loader">
				<span class="mui-spinner"></span> <span id="loading-text" >请耐心等候</span>
			</div>
			<div class="notes-box" style="display:none;">
				<i class="notes-moblie"></i>
				<p class="no-records-size">暂无可用红包</p>
			</div>
			<div id="tabbar-unused" class="mui-control-content mui-active" style="display: none;padding-bottom: 20px;">
				<ul class="Red-envelopes" id="hbBox">
					
				</ul>
			</div>
		</div>
		<script src="js/template.js"></script>
		<script src="js/template.function.js"></script>
		<script type="text/javascript" src="js/jquery-1.11.2.min.js" ></script>
		<script src="js/api.js"></script>
			
		<script>
		
			mui.plusReady(function(){
				var self = plus.webview.currentWebview()
				var moneyvalue = parseInt(self.money)
				console.log(moneyvalue)
				request = {'user_id': user.uid()};
				request.status = 1;
				user.GetHongbao({'request':request},function(res){
					//console.log(JSON.stringify(res))
					$(res.list).each(function(k,val){
						strs = parseInt(val.money);
						//console.log(strs)
						
						if( (moneyvalue)*(0.01) < 20 ){//假如小于2000
						 	if ( (strs) > (moneyvalue)*(0.01) ){//达不到使用规则
							}else{
								$("#hbBox").append(
									//'<li data-value="'+val.id+'-'+val.money+'" class="mui-table-view-cell" id="hbList">'+
									'<li data={"hbvalue":"'+val.id+'-'+val.money+'","money":'+val.money+',"tday":"'+val.tday+'"}  class="hbList">'+
										'<div class="hongbao-num">'+
											'<img src="images/wsy_hb.png"/>'+
											'<div class="hb-je " style="color: #DD524D;">￥<span style="font-size: 50px;">'+val.money+'</span></div>'+
											'<h5>还有'+val.tday+'过期</h5>'+
											'<p>有效期至'+getTime(val.endtime,"yyyy年MM月dd日")+'</p>'+
										'</div>'+
										'<div class="hongbao-cond">'+
											'<span class="hb-type">'+val.remarks+'</span>'+
											'<a>单笔投资满'+val.tmoney+'元及以上可用</a>'+
										'</div>'+
									'</li>'
								)
							}
						}else{
						 	if ( (strs) > (moneyvalue)*(0.005) ){
								
							}else{
								$("#hbBox").append(
									'<li data={"hbvalue":"'+val.id+'-'+val.money+'","money":'+val.money+',"tday":"'+val.tday+'"}  class="hbList">'+
										'<div class="hongbao-num">'+
											'<img src="images/wsy_hb.png"/>'+
											'<div class="hb-je " style="color: #DD524D;">￥<span style="font-size: 50px;">'+val.money+'</span></div>'+
											'<h5>还有'+val.tday+'过期</h5>'+
											'<p>有效期至'+getTime(val.endtime,"yyyy年MM月dd日")+'</p>'+
										'</div>'+
										'<div class="hongbao-cond">'+
											'<span class="hb-type">'+val.remarks+'</span>'+
											'<a>单笔投资满'+val.tmoney+'元及以上可用</a>'+
										'</div>'+
									'</li>'
								)
							}
						}
					});
					if($(".hbList").length==0){
						$(".notes-box").css("display","block")
					}
					$(".mui-loader").css("display","none")
					$("#tabbar-unused").css("display","block")
				})
				mui("#hbBox").on("tap",".hbList",function(){
					var hbdata = this.getAttribute('data');
					//var hbmoney=this.getAttribute('data');
					hbdata = eval("(" + hbdata + ")");
					console.log(JSON.stringify(hbdata))  
					var ljtzPage=plus.webview.getWebviewById("ljtz.html")
					mui.fire(ljtzPage,"getHongbao",hbdata)
					mui.back()
					
				})
				//时间方法
				function  getTime(date, format) {
				    date = new Date(date * 1000);
				    var map = {
				        "M": date.getMonth() + 1, //月份 
				        "d": date.getDate(), //日 
				        "h": date.getHours(), //小时 
				        "m": date.getMinutes(), //分 
				        "s": date.getSeconds(), //秒 
				        "q": Math.floor((date.getMonth() + 3) / 3), //季度 
				        "S": date.getMilliseconds() //毫秒 
				    };
				    format = format.replace(/([yMdhmsqS])+/g, function(all, t){
				        var v = map[t];
				        if(v !== undefined){
				            if(all.length > 1){
				                v = '0' + v;
				                v = v.substr(v.length-2);
				            }
				            return v;
				        }
				        else if(t === 'y'){
				            return (date.getFullYear() + '').substr(4 - all.length);
				        }
				        return all;
				    });
				    return format;
				}
			})
			
		
		</script>
		
	</body>
</html>