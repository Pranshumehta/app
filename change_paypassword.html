 <!DOCTYPE html>
<html>
	
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no, email=no" />
		<title>聚车金融</title>
		<link href="css/css.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.input-box input { 
				color: #333;
			}
			.wjzfmm{ 
				margin-top: -42px;
			}
			.lost-div{
				height: 40px;
				line-height: 40px;
			}
			.lost-pay-passsword{
				font-size: 14px;
				float: right;
			}
		</style>
	</head>
	
	<body>
		<div class="wrap wjzfmm clearfix mui-content">
			<ul class="reg-form clearfix">
				<li>
					<div class="input-box">
						<i class="ico-pwd2 ico24 icon"></i>
						<input type="password" id="password" name="password" pattern="[0-9]*"  class="reg-txt samePattern" placeholder="请输入原交易密码">
					</div>
				</li>
				<div class="lost-div">
					<a class="lost-pay-passsword c5">忘记交易密码？</a>
				</div>
				
				
				<li>
					<div class="input-box">
						<i class="ico-pwd2 ico24 icon"></i>
						<input type="password" id="change_password" name="change_password" pattern="[0-9]*" class="reg-txt samePattern" placeholder="请输入6位数字交易密码">
					</div>
				</li>
				<li>
					<div class="input-box">
						<i class="ico-pwd2 ico24 icon"></i>
						<input type="password" id="confirm_password" name="confirm_password" pattern="[0-9]*" class="reg-txt samePattern" placeholder="确认交易密码">
					</div>
				</li>
				<li class="opn"><button type="button" class="btn Large" id="reg-btn">确认</button></li>
			</ul>
	
			<div class="tel-info">
				<a class="number" href="" id='confirmBtn'><i class="ico-tel icon"></i>4001-123-990</a>
				<div class="title">工作时间09:00-17:30</div>
			</div>
		</div>
		<script language="javascript" type="text/javascript" src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/common.js" ></script>
		<script type="text/javascript" src="js/jquery-1.11.2.min.js" ></script>
		<script type="text/javascript" src="js/jQuery.md5.js" ></script>
		<script src="js/api.js" type="text/javascript" charset="utf-8"></script>
	 
		<script>
			mui.init();
			mui.plusReady(function(){
				mui("body").on("tap","#reg-btn",function(){
					//判断异地登录
					functionCom.checkToken(function(res){
						//console.log(res.error_no)
						if(res.error_no!=401){
							if(document.getElementById("change_password").value!=document.getElementById("confirm_password").value){
								plus.nativeUI.toast("两次交易密码不一致，请重新输入")
								return false;
							}else{
								request = {};
								request.username = store.get('username')
								request.old_paypassword = $.md5($("#password").val())
								request.password = document.getElementById("change_password").value;
								request.confirm_password = document.getElementById("confirm_password").value;
								if(!/\d{6}/.test(request.password)){
									alert("密码必须为6位数字")
									return false 
								}
								user.modifypaypwd(request,function(res){
									//console.log(JSON.stringify(request))
									console.log(JSON.stringify(res))
									if(res.status == 1){
										plus.nativeUI.toast("交易密码更改成功");
											// 关闭页面
											mui.back();
									}else{
										alert(res.msg);
									}
								})
							}
						}
					})//结束
					
				})
				mui("body").on("input",".samePattern",function(){
					var plength=$(this).val().length
					if(plength>6){
						$(this).val($(this).val().substr(0,6))
						console.log($(this).val())	
					}
				})
				//忘记交易密码？
				mui(".lost-div").on("tap",".lost-pay-passsword",function(e){
					//e.stopPropagation()
					inittemplate = getTemplate('template', 'template.html');
					var headerWebview = inittemplate.header;
					var contentWebview = inittemplate.content;
					contentWebview.loadURL("wjmmpay.html");
					mui.fire(headerWebview, 'updateHeader', {
						title: "忘记交易密码",
						showMenu: false,
						right_btn:""
					});
					mui.fire(headerWebview, 'loading');
					headerWebview.show('slide-in-right', 150);
					/*setTimeout(function(){		
						plus.webview.currentWebview().parent().hide()
					},300);*/
				})
				mui(".tel-info").on('tap','a#confirmBtn',function(){
				var btnArray = ['取消', '呼叫'];
				mui.confirm(' ','4001-123-990', btnArray, function(e) {
						if (e.index == 1) {
							window.location.href = 'tel:4001-123-990';
						} else {
						}
					})
				});
				
				
			})
			
		</script>
	</body>
</html>