<!DOCTYPE html>
<html>
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no, email=no" />
		<title>聚车金融</title>
		<link href="css/mui.min.css" rel="stylesheet" type="text/css" />
		<link href="css/css.css" rel="stylesheet" type="text/css" />
		<link href="css/integral.css" rel="stylesheet" type="text/css" /> 
		<link rel="stylesheet" href="css/iphone.css" />
		<script src="js/mui.min.js"></script>
		<style>
		.mui-table-view-cell:after {
			position: absolute;
			right: 0px;
			bottom: 0;
			left: 3%;
			height: 1px;
			width: 94%;
			content: '';
			-webkit-transform: scaleY(.5);
			transform: scaleY(.5);
			background-color: #c8c7cc
		}
		.mui-content>.mui-table-view:first-child{ margin-top: 0;}
		</style>
	</head>
	<body>
		<div class="mui-content" >
			<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul id="qd-list" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
						
					</ul>
				</div>
			</div>
		</div>
	
		<script id="tpl-item" type="text/html">
			{{each list as item i}}
		   		<li class="mui-table-view-cell" style="padding-top:6px;padding-bottom: 6px;">
					<div class="mui-table">
					    <div class="mui-table-cell mui-col-xs-6">
					    	{{if item.type=="sign_reward"}}
					    	<h4 style="font-size: 16px;line-height:23px;">签到奖励</h4>
					    	{{else}}
					    	<h4 style="font-size: 16px;line-height:23px;">已签到</h4>
					    	{{/if}}
					        <h5 style="line-height: 23px;">{{item.addtime | dateFormat:'yyyy-MM-dd hh:mm'}}</h5>
					    </div>
						<div class="mui-table-cell mui-col-xs-6 mui-text-right">
							<h4 class="c5" style="font-size: 16px;line-height:23px ;">+{{item.value}}</h4>
							{{if item.type=="sign_reward"}}
					    	<h5 style="line-height: 23px;">奖励积分</h5> 
					    	{{else}}
					    	<h5 style="line-height: 23px;">签到积分</h5> 
					    	{{/if}}
					    </div>
					</div>
				</li>
			{{/each}}
		</script>
		<script src="js/api.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.pullToRefresh.js"></script>
		<script src="js/mui.pullToRefresh.material.js"></script>
		<script src="js/template.js"></script>
		<script src="js/template.function.js"></script>
	    <script type="text/javascript" charset="utf-8">
	    	var curr_page = 0;
			mui.init({
				swipeBack:true ,//启用右滑关闭功能
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						contentnomore: '没有更多数据了',
						callback: pullupRefresh
					}
				}
			});			
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					curr_page = 1;
					getdata(curr_page);
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
					mui('#pullrefresh').pullRefresh().refresh(true);
				}, 400);
			}
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					curr_page = curr_page + 1;
					getdata(curr_page);
				}, 100);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 100);
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
			function getdata(page){	
				request = {'username': store.get('username'),'epage':10,'nid':'sign'};
				request.page = page;
				credit.GetLogList({'request':request},function(res){//$data和回调函数
					console.log(JSON.stringify(res));
					var html = template('tpl-item',res);
					var ul = document.querySelector('#qd-list');
					var upflag = res.page >= res.total_page ? true : false;
					if(page > 1){
					ul.innerHTML = ul.innerHTML + html;
					}else{
						ul.innerHTML =html;
					}
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(upflag);
					if(res.total == 0){
						document.querySelector(".mui-content").innerHTML = '<div class="notes-box">'+
						'<i class="notes-moblie"></i>'+
						'<p class="no-records-size">暂无记录</p>'+
						'</div>';
						mui('#pullrefresh').pullRefresh().disablePullupToRefresh();
					}
				})	
			}
	
	    </script>                       
	</body>
</html>